// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Admin kullanıcı modeli
model User {
  id        String   @id @default(cuid())
  name      String?
  email     String   @unique
  password  String // Hash'lenmiş şifre
  role      Role     @default(USER)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// Kullanıcı rolleri
enum Role {
  USER
  ADMIN
}

// Oturum modeli
model Session {
  id           String   @id @default(cuid())
  userId       String
  expires      DateTime
  sessionToken String   @unique
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

// Desteklenen diller modeli
model Language {
  id        String   @id @default(cuid())
  code      String   @unique // Dil kodu (örn: 'en', 'tr')
  name      String // Dilin tam adı (örn: 'English', 'Türkçe')
  isActive  Boolean  @default(true) // Dilin sitede aktif olup olmadığını belirtir
  isDefault Boolean  @default(false) // Varsayılan dil olup olmadığını belirtir (sadece biri true olabilir)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  blogTranslations   BlogTranslation[]
  hizmetTranslations HizmetTranslation[] // Yeniden adlandırıldı ve HizmetTranslation'a bağlandı

  // Çevirisi yapılacak alt öğeler için dil ilişkileri
  hizmetOverviewTabTranslations    HizmetOverviewTabTranslation[]
  hizmetWhyItemTranslations        HizmetWhyItemTranslation[]
  hizmetTestimonialTranslations    HizmetTestimonialTranslation[]
  hizmetRecoveryItemTranslations   HizmetRecoveryItemTranslation[]
  hizmetExpertItemTranslations     HizmetExpertItemTranslation[]
  hizmetPricingPackageTranslations HizmetPricingPackageTranslation[]
  generalSettingTranslations       GeneralSettingTranslation[] // Yeni eklenecek alan
}

// Blog modeli
model Blog {
  id            String            @id @default(cuid())
  coverImageUrl String?
  isPublished   Boolean           @default(false)
  publishedAt   DateTime?
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt
  translations  BlogTranslation[]
}

// Blog çevirileri modeli
model BlogTranslation {
  id              String   @id @default(cuid())
  slug            String?
  title           String
  fullDescription String
  content         String   @db.Text
  tocItems        Json?
  blog            Blog     @relation(fields: [blogId], references: [id], onDelete: Cascade)
  blogId          String
  language        Language @relation(fields: [languageCode], references: [code], onDelete: Cascade)
  languageCode    String

  @@unique([blogId, languageCode])
}

// ----- HİZMET MODELLERİ YENİ YAPI -----

// Hizmet Ana Modeli (Dil Bağımsız)
model Hizmet {
  id        String   @id @default(cuid())
  published Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // --- Dil Bağımsız Temel Resimler ---
  heroImageUrl          String?
  heroImageAlt          String? // Ana/varsayılan alt text
  whyBackgroundImageUrl String?
  ctaBackgroundImageUrl String?
  ctaMainImageUrl       String?
  ctaMainImageAlt       String? // Ana/varsayılan alt text
  introVideoId          String? // Buraya taşındı

  // --- Dil Bağımsız Resim Koleksiyonları ---
  marqueeImages HizmetMarqueeImage[]
  galleryImages HizmetGalleryImage[]
  ctaAvatars    HizmetCtaAvatar[]

  // --- Dil Bağımsız Yapısal Öğeler (Metinleri çevrilecek) ---
  overviewTabDefinitions    HizmetOverviewTabDefinition[]
  whyItemDefinitions        HizmetWhyItemDefinition[]
  testimonialDefinitions    HizmetTestimonialDefinition[]
  recoveryItemDefinitions   HizmetRecoveryItemDefinition[]
  expertItemDefinitions     HizmetExpertItemDefinition[]
  pricingPackageDefinitions HizmetPricingPackageDefinition[]

  // --- Çeviriler ---
  translations HizmetTranslation[]
}

// Hizmet Çeviri Modeli (Dile Özgü Metinler)
model HizmetTranslation {
  id           String   @id @default(cuid())
  hizmet       Hizmet   @relation(fields: [hizmetId], references: [id], onDelete: Cascade)
  hizmetId     String
  language     Language @relation(fields: [languageCode], references: [code], onDelete: Cascade)
  languageCode String

  // --- Dile Özgü Metinsel Alanlar ---
  slug        String // URL parçası (dil ile birlikte unique)
  breadcrumb  String // Sayfa üstü navigasyon yolu
  title       String // Hizmet Başlığı
  description String // Hizmet Kısa Açıklama

  // --- Hero Alanı (Metinler) ---
  // heroImageUrl ve heroImageAlt Hizmet modeline taşındı

  // --- İçindekiler ve Sağ CTA Alanı (TocAndCtaSection) (Metinler) ---
  tocTitle          String
  tocAuthorInfo     String?
  tocCtaDescription String
  // tocItems ilişkisi aşağıda, HizmetTranslation'a bağlı kalacak

  // --- Resim Marquee (Kaydırmalı Resimler) ---
  // marqueeImages ilişkisi Hizmet modeline taşındı

  // --- Tedavi Tanıtım Alanı (TreatmentIntroSection) (Metinler) ---
  introTitle               String
  introDescription         String
  introPrimaryButtonText   String
  introPrimaryButtonLink   String
  introSecondaryButtonText String
  introSecondaryButtonLink String
  // introLinks ilişkisi aşağıda, HizmetTranslation'a bağlı kalacak

  // --- Tedaviye Genel Bakış (TreatmentOverview) (Ana Başlıklar) ---
  overviewSectionTitle       String // Bölümün genel başlığı
  overviewSectionDescription String?
  // overviewTabs içeriklerinin çevirileri HizmetOverviewTabTranslation'da olacak

  // --- Neden Celyxmed (WhyCelyxmed) (Ana Başlık) ---
  whySectionTitle String // Bölümün genel başlığı
  // whyItems içeriklerinin çevirileri HizmetWhyItemTranslation'da olacak
  // whyBackgroundImageUrl Hizmet modeline taşındı

  // --- Galeri (GallerySection) (Ana Başlıklar) ---
  gallerySectionTitle       String
  gallerySectionDescription String
  // galleryImages ilişkisi Hizmet modeline taşındı

  // --- Yorumlar (TestimonialsSection) (Ana Başlık) ---
  testimonialsSectionTitle String?
  // testimonials içeriklerinin çevirileri HizmetTestimonialTranslation'da olacak

  // --- Prosedür Adımları (ProcedureSteps) (Ana Başlıklar) ---
  stepsSectionTitle       String
  stepsSectionDescription String?
  // steps ilişkisi aşağıda, HizmetTranslation'a bağlı kalacak

  // --- İyileşme Bilgisi (RecoveryInfo) (Ana Başlıklar) ---
  recoverySectionTitle       String
  recoverySectionDescription String?
  // recoveryItems içeriklerinin çevirileri HizmetRecoveryItemTranslation'da olacak

  // --- Ana CTA Alanı (CtaSection) (Metinler) ---
  ctaTagline     String?
  ctaTitle       String
  ctaDescription String
  ctaButtonText  String
  ctaButtonLink  String?
  ctaAvatarText  String?
  // ctaAvatars, ctaBackgroundImageUrl, ctaMainImageUrl Hizmet modeline taşındı

  // --- Fiyatlandırma (PricingSection) (Ana Başlıklar) ---
  pricingSectionTitle       String
  pricingSectionDescription String?
  // pricingPackages içeriklerinin çevirileri HizmetPricingPackageTranslation'da olacak

  // --- Uzmanlarla Tanışın (MeetExperts) (Ana Başlıklar) ---
  expertsSectionTitle String
  expertsTagline      String?
  // expertItems içeriklerinin çevirileri HizmetExpertItemTranslation'da olacak

  // --- Sıkça Sorulan Sorular (FaqSection) (Ana Başlıklar) ---
  faqSectionTitle       String
  faqSectionDescription String?
  // faqs ilişkisi aşağıda, HizmetTranslation'a bağlı kalacak

  // --- SEO Meta Alanları ---
  metaTitle       String?
  metaDescription String?
  metaKeywords    String?

  // --- HizmetTranslation'a Bağlı Kalan Tamamen Çeviriye Özgü Listeler ---
  tocItems   HizmetTocItem[]
  introLinks HizmetIntroLink[]
  steps      HizmetStep[]
  faqs       HizmetFaqItem[]
  // pricingPackages ilişkisi HizmetPricingPackageDefinition/Translation'a taşındı

  @@unique([hizmetId, languageCode])
  @@unique([slug, languageCode])
}

// ----- HİZMET ALT MODELLERİ YENİ YAPI -----

// --- Doğrudan Hizmet'e Bağlı Dil Bağımsız Resim Koleksiyonları ---

model HizmetMarqueeImage {
  id       String @id @default(cuid())
  src      String
  alt      String // Ana/varsayılan alt text
  order    Int    @default(0)
  hizmet   Hizmet @relation(fields: [hizmetId], references: [id], onDelete: Cascade)
  hizmetId String
}

model HizmetGalleryImage {
  id       String @id @default(cuid())
  src      String
  alt      String // Ana/varsayılan alt text
  order    Int    @default(0)
  hizmet   Hizmet @relation(fields: [hizmetId], references: [id], onDelete: Cascade)
  hizmetId String
}

model HizmetCtaAvatar {
  id       String @id @default(cuid())
  src      String
  alt      String // Ana/varsayılan alt text
  order    Int    @default(0)
  hizmet   Hizmet @relation(fields: [hizmetId], references: [id], onDelete: Cascade)
  hizmetId String
}

// --- HizmetTranslation'a Bağlı, Tamamen Çeviriye Özgü Yapısal Öğeler ---

model HizmetTocItem {
  id                  String            @id @default(cuid())
  text                String
  isBold              Boolean           @default(false)
  level               Int?
  order               Int               @default(0)
  hizmetTranslation   HizmetTranslation @relation(fields: [hizmetTranslationId], references: [id], onDelete: Cascade)
  hizmetTranslationId String
}

model HizmetIntroLink {
  id                  String            @id @default(cuid())
  targetId            String
  number              String
  text                String
  order               Int               @default(0)
  hizmetTranslation   HizmetTranslation @relation(fields: [hizmetTranslationId], references: [id], onDelete: Cascade)
  hizmetTranslationId String
}

model HizmetStep {
  id                  String            @id @default(cuid())
  title               String
  description         String
  linkText            String?
  order               Int               @default(0)
  hizmetTranslation   HizmetTranslation @relation(fields: [hizmetTranslationId], references: [id], onDelete: Cascade)
  hizmetTranslationId String
}

model HizmetFaqItem {
  id                  String            @id @default(cuid())
  question            String
  answer              String            @db.Text
  order               Int               @default(0)
  hizmetTranslation   HizmetTranslation @relation(fields: [hizmetTranslationId], references: [id], onDelete: Cascade)
  hizmetTranslationId String
}

// --- Karmaşık Alt Öğeler: Definition (Dil Bağımsız) ve Translation (Dile Özgü Metin) ---

// Genel Bakış Tab'ı
model HizmetOverviewTabDefinition {
  id           String                         @id @default(cuid())
  hizmet       Hizmet                         @relation(fields: [hizmetId], references: [id], onDelete: Cascade)
  hizmetId     String
  value        String // Tab için unique bir değer (örn: "tab1")
  imagePath    String? // Dil bağımsız resim
  imageAlt     String? // Ana/varsayılan alt text
  order        Int                            @default(0)
  translations HizmetOverviewTabTranslation[]

  @@unique([hizmetId, value]) // Bir hizmet içinde tab value'ları unique olmalı
}

model HizmetOverviewTabTranslation {
  id           String                      @id @default(cuid())
  definition   HizmetOverviewTabDefinition @relation(fields: [definitionId], references: [id], onDelete: Cascade)
  definitionId String
  language     Language                    @relation(fields: [languageCode], references: [code], onDelete: Cascade)
  languageCode String
  triggerText  String // Tab başlığı (buton metni)
  title        String // İçerik başlığı
  content      String                      @db.Text
  buttonText   String
  buttonLink   String?

  @@unique([definitionId, languageCode])
}

// Neden Celyxmed Öğesi
model HizmetWhyItemDefinition {
  id           String                     @id @default(cuid())
  hizmet       Hizmet                     @relation(fields: [hizmetId], references: [id], onDelete: Cascade)
  hizmetId     String
  number       String // Dil bağımsız numara/sıra
  order        Int                        @default(0)
  translations HizmetWhyItemTranslation[]
}

model HizmetWhyItemTranslation {
  id           String                  @id @default(cuid())
  definition   HizmetWhyItemDefinition @relation(fields: [definitionId], references: [id], onDelete: Cascade)
  definitionId String
  language     Language                @relation(fields: [languageCode], references: [code], onDelete: Cascade)
  languageCode String
  title        String
  description  String

  @@unique([definitionId, languageCode])
}

// Hizmete Özel Yorum
model HizmetTestimonialDefinition {
  id           String                         @id @default(cuid())
  hizmet       Hizmet                         @relation(fields: [hizmetId], references: [id], onDelete: Cascade)
  hizmetId     String
  stars        Int                            @default(5) // Dil bağımsız
  imageUrl     String? // Dil bağımsız resim
  order        Int                            @default(0)
  translations HizmetTestimonialTranslation[]
}

model HizmetTestimonialTranslation {
  id           String                      @id @default(cuid())
  definition   HizmetTestimonialDefinition @relation(fields: [definitionId], references: [id], onDelete: Cascade)
  definitionId String
  language     Language                    @relation(fields: [languageCode], references: [code], onDelete: Cascade)
  languageCode String
  text         String
  author       String
  treatment    String? // Tedavi adı (çevrilebilir)

  @@unique([definitionId, languageCode])
}

// İyileşme Bilgisi Öğesi
model HizmetRecoveryItemDefinition {
  id           String                          @id @default(cuid())
  hizmet       Hizmet                          @relation(fields: [hizmetId], references: [id], onDelete: Cascade)
  hizmetId     String
  imageUrl     String // Dil bağımsız resim
  imageAlt     String // Ana/varsayılan alt text
  order        Int                             @default(0)
  translations HizmetRecoveryItemTranslation[]
}

model HizmetRecoveryItemTranslation {
  id           String                       @id @default(cuid())
  definition   HizmetRecoveryItemDefinition @relation(fields: [definitionId], references: [id], onDelete: Cascade)
  definitionId String
  language     Language                     @relation(fields: [languageCode], references: [code], onDelete: Cascade)
  languageCode String
  title        String
  description  String

  @@unique([definitionId, languageCode])
}

// Fiyatlandırma Paketi
model HizmetPricingPackageDefinition {
  id           String                            @id @default(cuid())
  hizmet       Hizmet                            @relation(fields: [hizmetId], references: [id], onDelete: Cascade)
  hizmetId     String
  isFeatured   Boolean                           @default(false) // Dil bağımsız
  order        Int                               @default(0)
  translations HizmetPricingPackageTranslation[]
}

model HizmetPricingPackageTranslation {
  id           String                         @id @default(cuid())
  definition   HizmetPricingPackageDefinition @relation(fields: [definitionId], references: [id], onDelete: Cascade)
  definitionId String
  language     Language                       @relation(fields: [languageCode], references: [code], onDelete: Cascade)
  languageCode String
  title        String
  price        String // Fiyat (metin olarak, çevrilebilir)
  features     String[] // Özellikler listesi (çevrilebilir)

  @@unique([definitionId, languageCode])
}

// Hizmete Özel Uzman
model HizmetExpertItemDefinition {
  id           String                        @id @default(cuid())
  hizmet       Hizmet                        @relation(fields: [hizmetId], references: [id], onDelete: Cascade)
  hizmetId     String
  imageUrl     String // Dil bağımsız resim
  imageAlt     String // Ana/varsayılan alt text
  order        Int                           @default(0)
  translations HizmetExpertItemTranslation[]
}

model HizmetExpertItemTranslation {
  id           String                     @id @default(cuid())
  definition   HizmetExpertItemDefinition @relation(fields: [definitionId], references: [id], onDelete: Cascade)
  definitionId String
  language     Language                   @relation(fields: [languageCode], references: [code], onDelete: Cascade)
  languageCode String
  name         String
  title        String // Uzmanlık alanı/unvanı
  description  String
  ctaText      String?

  @@unique([definitionId, languageCode])
}

// ----- GENEL AYARLAR MODELLERİ -----

// Genel Ayarlar Ana Modeli (Dil Bağımsız)
model GeneralSetting {
  id              String  @id @default(cuid())
  faviconUrl      String? // Favicon dosyasının URL'si
  logoUrl         String? // Logo dosyasının URL'si
  whatsappNumber  String?
  phoneNumber     String?
  emailAddress    String?
  fullAddress     String? @db.Text
  googleMapsEmbed String? @db.Text // Google Maps iframe kodu

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  translations GeneralSettingTranslation[]
}

// Genel Ayarlar Çeviri Modeli (Dile Özgü Metinler ve Linkler)
model GeneralSettingTranslation {
  id               String         @id @default(cuid())
  generalSetting   GeneralSetting @relation(fields: [generalSettingId], references: [id], onDelete: Cascade)
  generalSettingId String
  language         Language       @relation(fields: [languageCode], references: [code], onDelete: Cascade)
  languageCode     String

  // Header Buton Alanı
  headerButtonText String?
  headerButtonLink String?

  // Sosyal Medya Alanları
  socialYoutubeUrl   String?
  socialInstagramUrl String?
  socialTiktokUrl    String?
  socialFacebookUrl  String?
  socialLinkedinUrl  String?

  // Copyright Alanı
  copyrightText String?

  // Anasayfa Sticky İletişim Butonu
  stickyButtonText String?
  stickyButtonLink String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([generalSettingId, languageCode])
}
