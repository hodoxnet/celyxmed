// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Admin kullanıcı modeli
model User {
  id            String      @id @default(cuid())
  name          String?
  email         String      @unique
  password      String  // Hash'lenmiş şifre
  role          Role        @default(USER)
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
}

// Kullanıcı rolleri
enum Role {
  USER
  ADMIN
}

// Oturum modeli
model Session {
  id           String   @id @default(cuid())
  userId       String
  expires      DateTime
  sessionToken String   @unique
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

// Desteklenen diller modeli
model Language {
  id        String  @id @default(cuid())
  code      String  @unique // Dil kodu (örn: 'en', 'tr')
  name      String  // Dilin tam adı (örn: 'English', 'Türkçe')
  isActive  Boolean @default(true) // Dilin sitede aktif olup olmadığını belirtir
  isDefault Boolean @default(false) // Varsayılan dil olup olmadığını belirtir (sadece biri true olabilir)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Blog çevirileri ile ilişki
  blogTranslations BlogTranslation[]
  // Hizmet Detayları ile ilişki (Eklendi)
  hizmetDetaylari HizmetDetay[]

  // @@unique([isDefault], name: "unique_default_language") // Bu kısıtlama Prisma'da doğrudan desteklenmiyor, uygulama seviyesinde kontrol edilecek.
}

// Blog modeli
model Blog {
  id          String   @id @default(cuid())
  // slug        String   @unique // URL slug - KALDIRILDI
  coverImageUrl String? // Kapak görseli URL'si
  isPublished Boolean  @default(false) // Yayın durumu
  publishedAt DateTime? // Yayın tarihi (yayınlanmamışsa null)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Blog çevirileri ile ilişki
  translations BlogTranslation[]
}

// Blog çevirileri modeli
model BlogTranslation {
  id             String  @id @default(cuid())
  slug           String? // URL slug (dile özgü) - EKLENDİ ve GEÇİCİ OLARAK İSTEĞE BAĞLI YAPILDI
  title          String  // Blog başlığı
  fullDescription String  // Kısa özet/açıklama
  content        String  @db.Text // HTML formatında ana içerik
  tocItems       Json?   // İçindekiler tablosu öğeleri (JSON formatında)

  // Blog ile ilişki
  blog           Blog    @relation(fields: [blogId], references: [id], onDelete: Cascade)
  blogId         String

  // Dil ile ilişki
  language       Language @relation(fields: [languageCode], references: [code], onDelete: Cascade)
  languageCode   String

  // Blog-dil ikilisi eşsiz olmalı
  @@unique([blogId, languageCode])
  // Dil kodu ve slug ikilisi eşsiz olmalı (örn: /en/my-post ve /tr/my-post olabilir, ama iki tane /en/my-post olamaz)
  // @@unique([languageCode, slug]) // Geçici olarak kaldırıldı, null değerler unique olamaz
}


// ----- YENİ EKLENEN MODELLER -----

// Hizmet Detay Ana Modeli
model HizmetDetay {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // --- Temel Bilgiler ---
  slug        String   // URL parçası (dil ile birlikte unique)
  breadcrumb  String   // Sayfa üstü navigasyon yolu
  title       String   // Hizmet Başlığı
  description String   // Hizmet Kısa Açıklama
  published   Boolean  @default(false) // Yayında mı?
  language    Language @relation(fields: [languageCode], references: [code])
  languageCode String   // Hangi dile ait olduğu

  // --- Hero Alanı ---
  heroImageUrl String
  heroImageAlt String

  // --- İçindekiler ve Sağ CTA Alanı (TocAndCtaSection) ---
  tocTitle       String
  tocAuthorInfo  String?
  tocItems       HizmetTocItem[] // İlişkili Model
  tocCtaDescription String

  // --- Resim Marquee (Kaydırmalı Resimler) ---
  marqueeImages HizmetMarqueeImage[] // İlişkili Model

  // --- Tedavi Tanıtım Alanı (TreatmentIntroSection) ---
  introVideoId            String?
  introTitle              String
  introDescription        String
  introPrimaryButtonText  String
  introPrimaryButtonLink  String
  introSecondaryButtonText String
  introSecondaryButtonLink String
  introLinks              HizmetIntroLink[] // İlişkili Model

  // --- Tedaviye Genel Bakış (TreatmentOverview) ---
  overviewTitle       String
  overviewDescription String
  overviewTabs        HizmetOverviewTab[] // İlişkili Model

  // --- Neden Celyxmed (WhyCelyxmed) ---
  whyTitle              String
  whyBackgroundImageUrl String?
  whyItems              HizmetWhyItem[] // İlişkili Model

  // --- Galeri (GallerySection) ---
  galleryTitle       String
  galleryDescription String
  galleryImages      HizmetGalleryImage[] // İlişkili Model

  // --- Yorumlar (TestimonialsSection) ---
  testimonialsSectionTitle String?
  testimonials             HizmetTestimonial[] // İlişkili Model

  // --- Prosedür Adımları (ProcedureSteps) ---
  stepsTitle       String
  stepsDescription String?
  steps            HizmetStep[] // İlişkili Model

  // --- İyileşme Bilgisi (RecoveryInfo) ---
  recoveryTitle       String
  recoveryDescription String?
  recoveryItems       HizmetRecoveryItem[] // İlişkili Model

  // --- Ana CTA Alanı (CtaSection) ---
  ctaTagline          String?
  ctaTitle            String
  ctaDescription      String
  ctaButtonText       String
  ctaButtonLink       String?
  ctaAvatars          HizmetCtaAvatar[] // İlişkili Model
  ctaAvatarText       String?
  ctaBackgroundImageUrl String?
  ctaMainImageUrl     String?
  ctaMainImageAlt     String?

  // --- Fiyatlandırma (PricingSection) ---
  pricingTitle       String
  pricingDescription String?
  pricingPackages    HizmetPricingPackage[] // İlişkili Model

  // --- Uzmanlarla Tanışın (MeetExperts) ---
  expertsSectionTitle String
  expertsTagline      String?
  expertItems         HizmetExpertItem[] // İlişkili Model

  // --- Sıkça Sorulan Sorular (FaqSection) ---
  faqSectionTitle       String
  faqSectionDescription String?
  faqs                  HizmetFaqItem[] // İlişkili Model (Hizmete özel)

  // --- SEO Meta Alanları ---
  metaTitle       String?
  metaDescription String?
  metaKeywords    String?

  @@unique([slug, languageCode]) // Slug'ın dil bazında unique olmasını sağlar
}

// ----- İlişkili Modeller -----

// İçindekiler Öğesi
model HizmetTocItem {
  id            String  @id @default(cuid())
  text          String
  isBold        Boolean @default(false)
  level         Int?
  order         Int     @default(0) // Sıralama için default değer eklendi
  hizmetDetay   HizmetDetay @relation(fields: [hizmetDetayId], references: [id], onDelete: Cascade)
  hizmetDetayId String
}

// Marquee Resmi
model HizmetMarqueeImage {
  id            String  @id @default(cuid())
  src           String
  alt           String
  order         Int     @default(0) // Sıralama için default değer eklendi
  hizmetDetay   HizmetDetay @relation(fields: [hizmetDetayId], references: [id], onDelete: Cascade)
  hizmetDetayId String
}

// Tanıtım Linki
model HizmetIntroLink {
  id            String  @id @default(cuid())
  targetId      String
  number        String
  text          String
  order         Int     @default(0) // Sıralama için default değer eklendi
  hizmetDetay   HizmetDetay @relation(fields: [hizmetDetayId], references: [id], onDelete: Cascade)
  hizmetDetayId String
}

// Genel Bakış Tab'ı
model HizmetOverviewTab {
  id            String  @id @default(cuid())
  value         String
  triggerText   String
  title         String
  content       String  @db.Text // Uzun içerik olabileceği için Text tipi
  imageUrl      String
  imageAlt      String
  buttonText    String
  order         Int     @default(0) // Sıralama için default değer eklendi
  hizmetDetay   HizmetDetay @relation(fields: [hizmetDetayId], references: [id], onDelete: Cascade)
  hizmetDetayId String
}

// Neden Celyxmed Öğesi
model HizmetWhyItem {
  id            String  @id @default(cuid())
  number        String
  title         String
  description   String
  order         Int     @default(0) // Sıralama için default değer eklendi
  hizmetDetay   HizmetDetay @relation(fields: [hizmetDetayId], references: [id], onDelete: Cascade)
  hizmetDetayId String
}

// Galeri Resmi
model HizmetGalleryImage {
  id            String  @id @default(cuid())
  src           String
  alt           String
  order         Int     @default(0) // Sıralama için default değer eklendi
  hizmetDetay   HizmetDetay @relation(fields: [hizmetDetayId], references: [id], onDelete: Cascade)
  hizmetDetayId String
}

// Hizmete Özel Yorum
model HizmetTestimonial {
  id            String  @id @default(cuid())
  stars         Int     @default(5)
  text          String
  author        String
  treatment     String?
  imageUrl      String?
  order         Int     @default(0) // Sıralama için default değer eklendi
  hizmetDetay   HizmetDetay @relation(fields: [hizmetDetayId], references: [id], onDelete: Cascade)
  hizmetDetayId String
}

// Prosedür Adımı
model HizmetStep {
  id            String  @id @default(cuid())
  title         String
  description   String
  linkText      String?
  order         Int     @default(0) // Sıralama için default değer eklendi
  hizmetDetay   HizmetDetay @relation(fields: [hizmetDetayId], references: [id], onDelete: Cascade)
  hizmetDetayId String
}

// İyileşme Bilgisi Öğesi
model HizmetRecoveryItem {
  id            String  @id @default(cuid())
  title         String
  description   String
  imageUrl      String
  imageAlt      String
  order         Int     @default(0) // Sıralama için default değer eklendi
  hizmetDetay   HizmetDetay @relation(fields: [hizmetDetayId], references: [id], onDelete: Cascade)
  hizmetDetayId String
}

// CTA Avatarı
model HizmetCtaAvatar {
  id            String  @id @default(cuid())
  src           String
  alt           String
  order         Int     @default(0) // Sıralama için default değer eklendi
  hizmetDetay   HizmetDetay @relation(fields: [hizmetDetayId], references: [id], onDelete: Cascade)
  hizmetDetayId String
}

// Fiyatlandırma Paketi
model HizmetPricingPackage {
  id            String   @id @default(cuid())
  title         String
  price         String
  features      String[]
  isFeatured    Boolean  @default(false)
  order         Int      @default(0) // Sıralama için default değer eklendi
  hizmetDetay   HizmetDetay @relation(fields: [hizmetDetayId], references: [id], onDelete: Cascade)
  hizmetDetayId String
}

// Hizmete Özel Uzman
model HizmetExpertItem {
  id            String  @id @default(cuid())
  name          String
  title         String
  description   String
  imageUrl      String
  imageAlt      String
  ctaText       String?
  order         Int     @default(0) // Sıralama için default değer eklendi
  hizmetDetay   HizmetDetay @relation(fields: [hizmetDetayId], references: [id], onDelete: Cascade)
  hizmetDetayId String
}

// Hizmete Özel SSS Öğesi
model HizmetFaqItem {
  id            String  @id @default(cuid())
  question      String
  answer        String  @db.Text // Uzun cevaplar için Text tipi
  order         Int     @default(0) // Sıralama için default değer eklendi
  hizmetDetay   HizmetDetay @relation(fields: [hizmetDetayId], references: [id], onDelete: Cascade)
  hizmetDetayId String
}
