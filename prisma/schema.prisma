// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Admin kullanıcı modeli
model User {
  id            String      @id @default(cuid())
  name          String?
  email         String      @unique
  password      String  // Hash'lenmiş şifre
  role          Role        @default(USER)
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
}

// Kullanıcı rolleri
enum Role {
  USER
  ADMIN
}

// Oturum modeli
model Session {
  id           String   @id @default(cuid())
  userId       String
  expires      DateTime
  sessionToken String   @unique
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

// Desteklenen diller modeli
model Language {
  id        String  @id @default(cuid())
  code      String  @unique // Dil kodu (örn: 'en', 'tr')
  name      String  // Dilin tam adı (örn: 'English', 'Türkçe')
  isActive  Boolean @default(true) // Dilin sitede aktif olup olmadığını belirtir
  isDefault Boolean @default(false) // Varsayılan dil olup olmadığını belirtir (sadece biri true olabilir)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Blog çevirileri ile ilişki
  blogTranslations BlogTranslation[]

  // @@unique([isDefault], name: "unique_default_language") // Bu kısıtlama Prisma'da doğrudan desteklenmiyor, uygulama seviyesinde kontrol edilecek.
}

// Blog modeli
model Blog {
  id          String   @id @default(cuid())
  slug        String   @unique // URL slug
  coverImageUrl String? // Kapak görseli URL'si
  isPublished Boolean  @default(false) // Yayın durumu
  publishedAt DateTime? // Yayın tarihi (yayınlanmamışsa null)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Blog çevirileri ile ilişki
  translations BlogTranslation[]
}

// Blog çevirileri modeli
model BlogTranslation {
  id             String  @id @default(cuid())
  title          String  // Blog başlığı
  fullDescription String  // Kısa özet/açıklama
  content        String  @db.Text // HTML formatında ana içerik
  tocItems       Json?   // İçindekiler tablosu öğeleri (JSON formatında)
  
  // Blog ile ilişki
  blog           Blog    @relation(fields: [blogId], references: [id], onDelete: Cascade)
  blogId         String
  
  // Dil ile ilişki
  language       Language @relation(fields: [languageCode], references: [code], onDelete: Cascade)
  languageCode   String
  
  // Blog-dil ikilisi eşsiz olmalı
  @@unique([blogId, languageCode])
}
